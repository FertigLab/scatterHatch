---
title: "Scatterplot Hatching Function"
author: "Tejas Guha"
date: "August 29, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r warning=FALSE, echo=FALSE, message=FALSE}
library(ggplot2)
library(devtools)
load_all("D:\\umd\\summer 2020\\scatterHatch")
```

## Introduction

The objective of this function is to efficiently create unique patterns for different groups in a scatterplot so that if the groups were colored the same, they would be distinguishable.  Thus, this function would be useful in making scatterplot visualizations more accessible to those with visual impairments such as color blindness.  The data that will be used to showcase the function is [a tissue-CyCIF PDAC dataset from Lin et al](http://spatial.rc.fas.harvard.edu/spatialgiotto/giotto.cycif.html).  Here is a look at the dataset after some preprocessing.

```{r echo=FALSE, message=FALSE, warning=FALSE, tidy=TRUE, cache=TRUE, comment=""}
#creating the sample dataframe to work with
pdacData = read.csv("D://umd//summer 2020//spatial-datasets-master//spatial-datasets-master//data//2018_CyCIF_PDAC//rawdata_Figure78_PDAC//rawdata_Figure7&8_PDAC.csv")
pdacData$cellID = paste0('cell_', 1:nrow(pdacData))
pdacData$Yt <- -pdacData$Yt
pancreas_frames = c(1:6, 27:31, 15:19, 40:44)
PDAC_frames = c(23:26, 35:37, 51:52, 64:65, 77)
small_intestines_frames = c(49:50, 63, 75:76, 88:89, 100:103, 112:116, 125:129, 137:140)
annotateLocation <- function(frame){
  if (frame %in% pancreas_frames){return("Pancreas")}
  if (frame %in% PDAC_frames){return("PDAC")}
  if (frame %in% small_intestines_frames){return("Small Intestine")}
  return("Other")
}
pdacData$location = sapply(pdacData$frame, annotateLocation)

sampleDF = pdacData
print(head(sampleDF[, c('Xt', 'Yt', 'location')]))
```


## How to Use it
To create a hatched scatterplot, use ```scatterHatch()``` which takes the following arguments:
```{r echo=FALSE}
parameters = c('data', 'x', 'y', 'factor', 'factorName', 'pointSize', 'gridSize', 'patternList', 'colorPalette')
paramDescript = c('A dataframe of the dataset being plotted', 'A numeric vector describing the x-coordinates of the points being plotted', 'A numeric vector describing the y-coordinates of the points being plotted', 'A vector describing what group each point belongs to', 'The legend title', 'ggplot2 point size', 'Integer describing the precision of the hatched patterns.  Larger the value, greater the precision at the expense of efficiency.  Default follows this expotential decay function: 500*e^(-pointSize/2.2) + 43.44965', 'List containing the aesthethics of each pattern', 'Character vector describing the point color of each group; default is color-blind friendly')

paramTable = data.frame(parameters, paramDescript)
knitr::kable(paramTable, col.names = c("Argument","Description"))

myTheme <- theme_classic() + theme(plot.title = element_text(family="serif", face="bold", size=25), 
                  axis.title.x = element_text(family="serif", size=20),
                  axis.text.x = element_text(family="serif",color="black", size=15),
                  axis.title.y = element_text(family="serif", size=20),
                  axis.text.y = element_text(family="serif",color="black", size=15)) +
                  theme(legend.title = element_text(family="serif", size=20, face="bold"),
                  legend.text = element_text(family="serif", size=15))
```


Here's a plot of the PDAC dataset with the default settings:
```{r echo=TRUE, message=FALSE, warning=FALSE, tidy=TRUE, cache=FALSE, comment="", dpi=300, fig.width=10, fig.asp=5.6/8.98}
plt <- scatterHatch(sampleDF, sampleDF$Xt, sampleDF$Yt, as.factor(sampleDF$location), "Tissue Type", 1) + myTheme
plot(plt)
```

Reducing the grid size to 10, drastically reducing the precision of the hatched lines.
```{r echo=TRUE, message=FALSE, warning=FALSE, tidy=TRUE, cache=FALSE, comment="", dpi=300, fig.width=10, fig.asp=5.6/8.98}
plt <- scatterHatch(sampleDF, sampleDF$Xt, sampleDF$Yt, as.factor(sampleDF$location), "Tissue Type", 1, gridSize=100) + myTheme
plot(plt)
```


### Controlling the Pattern Aesthetics
There are many characteristics of each pattern that can be controlled by the user.  These characteristics are passed into a list in the patternList argument of ```scatterHatch()```.

```{r echo=FALSE}
aesthe = c('pattern', 'density', 'sparsity', 'lineColor', 'lineType', 'lineWidth', 'pointAlpha')
aestheDescript = c('A string representing which pattern to use ("horizontal", "vertical", "positiveDiagonal", "negativeDiagonal")', 'A fraction representing how dense the lines in a pattern should be.  Must be less than or equal to 1, with the denominator as an integer and the numerator the number 1.  Greater the density value, denser the pattern. Default is 1/4', 'Value controlling the requirements for a point to be labelled as sparse and have an individual line pattern be rendered on it.  Less the sparsity value, less the requirements.  Value >= 1 and <= gridSize.  Default is 2% of the gridSize', 'Color of the pattern line', 'Type of line (e.g. dashed, dotted, etc.)',
                  'Width of the lines in the pattern',
                  'Alpha value of the points being plotted for each group')

aestheTable = data.frame(aesthe, aestheDescript)
knitr::kable(aestheTable, col.names = c("Aesthetics","Description"))
```
      

To make the positiveDiagonal pattern have red lines and the vertical pattern have dotted lines:

```{r echo=TRUE, message=FALSE, warning=FALSE, tidy=TRUE, cache=FALSE, comment="", dpi=300, fig.width=10, fig.asp=5.6/8.98}
patternList = list(list(pattern="positiveDiagonal", lineColor="red"), list(pattern="vertical", lineType="dotted"))
plt <- scatterHatch(sampleDF, sampleDF$Xt, sampleDF$Yt, as.factor(sampleDF$location), "Tissue Type", 1, patternList=patternList) + myTheme
plot(plt)
```


Having all the patterns in the list changes the ordering of the patterns assigned for each group.

```{r echo=TRUE, message=FALSE, warning=FALSE, tidy=TRUE, cache=FALSE, comment="", dpi=300, fig.width=10, fig.asp=5.6/8.98}
patternList = list(list(pattern="positiveDiagonal"), list(pattern="horizontal"), list(pattern="negativeDiagonal"), list(pattern="vertical"))
plt <- scatterHatch(sampleDF, sampleDF$Xt, sampleDF$Yt, as.factor(sampleDF$location), "Tissue Type", 1, patternList = patternList) + myTheme
plot(plt)
```


To get a closer look at how the sparsity value works, let's look at the "Other" tissue sample.  Here the sparsity has a value of 300.

```{r echo=FALSE, message=FALSE, warning=FALSE, tidy=TRUE, cache=FALSE, comment="", dpi=300, fig.width=10, fig.asp=5.6/8.98}
patternList = list(list(pattern="horizontal", lineAlpha=1, sparsity=300))
otherData = pdacData[pdacData$location == "Other",]
plt <- scatterHatch(otherData, otherData$Xt, otherData$Yt, as.factor(otherData$location), "Tissue Type", 1, patternList = patternList) + myTheme
plot(plt)
```


Notice how decreasing the sparsity value to 5 renders the patterns on some of the more isolated points.

```{r echo=FALSE, message=FALSE, warning=FALSE, tidy=TRUE, cache=FALSE, comment="", dpi=300, fig.width=10, fig.asp=5.6/8.98}
patternList = list(list(pattern="horizontal", lineAlpha=1, sparsity=5))
otherData = pdacData[pdacData$location == "Other",]
plt <- scatterHatch(otherData, otherData$Xt, otherData$Yt, as.factor(otherData$location), "Tissue Type", 1, patternList = patternList) + myTheme
plot(plt)
```
